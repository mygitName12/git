<html>
<head>
    <title>openvidu-hello-world</title>
  <!--   <link rel="stylesheet" href="__PUBLIC__/static/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/public/static/zTree/zTreeStyle.css">
    <script src="__PUBLIC__/static/layui/layui.js"></script>
    <script src="__PUBLIC__/static/jquery-3.3.1.min.js"></script>
    <script src="/plugin/chat/public/static/video/openvidu-browser-2.9.0.js"></script>
    <script src="/public/static/zTree/jquery.ztree.core-3.5.js"></script>
    <script src="/public/static/zTree/jquery.ztree.excheck-3.5.js"></script> -->
    <link rel="stylesheet" href="video.css">
    <style>
        /* .other-video{
            width: 1360px;
            height: 760px;
            border:1px solid #f40;
        } */
    </style>
</head>
<body>
<div class="layui-row video-container">
  <!--   <div class="layui-col-md2 main-left">
        <div class="layui-tab layui-tab-card" style="height: 100%;"> -->
            <!--<ul class="layui-tab-title">-->
                <!--<li class="layui-this">通讯录</li>-->
                <!--&lt;!&ndash;<li>会议室</li>&ndash;&gt;-->
            <!--</ul>-->
            <!-- <div class="layui-tab-content"> -->
                <!-- 自己的视频在这里展示 -->
              <!--   <div id="publisher"></div>
                <div class="layui-tab-item layui-show">
                    <div style="margin-top: 10px;">
                        <div class="layui-form" style="margin-top: 10px;">
                            <div class="layui-inline">
                                <div style="text-align: center;margin-top: 10px;">
                                    {if $isManager == 1}
                                    管理员和部门管理员显示此按钮
                                    <button id="publish" class="layui-btn layui-btn-normal">发起会议</button>
                                    {/if}
                                    所有用户都显示此按钮-->
                             <!-- <button id="join" class="layui-btn layui-btn-normal">加入会议</button>
                                    <button id="leave" onclick="leaveRoom()" class="layui-btn layui-btn-primary"
                                            style="display:none;">离开会议
                                    </button>
                                </div>
                                <div style="overflow: auto;height: 300px;margin-top: 10px;">
                                    <ul id="treeDemo" class="ztree"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-tab-item">
                    <select id="selectid">
                        <option value="-1">请选择会议室</option>
                        <option value="123456">1号会议室</option>
                        <option value="sdfsdf">2号会议室</option>
                        <option value="cxcvx">3号会议室</option>
                        <option value="jhjkhk">4号会议室</option>
                    </select>
                </div>
            </div>
        </div>
    </div>  -->
    <!-- <div class="layui-col-md10 main-right"> -->
        <!-- 对方的视频在这里展示 -->
    <div class="autobox">
        <div id="subscriber" class="other-video">
            <video autoplay  id="" src="./12.mp4" controls="controls" class="video1"></video>
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video2"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video3"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video3"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video4"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video4"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video5"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video5"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video5"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video6"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video6"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video6"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video6"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video6"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video6"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video6"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video7"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video7"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video7"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video7"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video7"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video7"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video7"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video7"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video7"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video8"></video>
            <video autoplay  id="" src="./12.mp4" controls="controls" class="video8"></video>
            <video autoplay  id="" src="./12.mp4" controls="controls" class="video8"></video>
            <video autoplay  id="" src="./12.mp4" controls="controls" class="video8"></video> -->
            <!-- <video autoplay  id="" src="./12.mp4" controls="controls" class="video8"></video>
            <video autoplay  id="" src="./12.mp4" controls="controls" class="video8"></video>
            <video autoplay  id="" src="./12.mp4" controls="controls" class="video8"></video>
            <video autoplay  id="" src="./12.mp4" controls="controls" class="video8"></video>
            <video autoplay  id="" src="./12.mp4" controls="controls" class="video8"></video>
            <video autoplay  id="" src="./12.mp4" controls="controls"  class="video8"></video>
            <video autoplay  id="" src="./12.mp4" controls="controls"  class="video8"></video>
             -->
        </div>
    </div>
    </div>
</div>

<script>
    // 初始化 start//
    var OV;						// OpenVidu object to initialize a session
    var session;				// Session object where the user will connect
    var publisher;				// Publisher object which the user will publish
    var sessionId;				// Unique identifier of the session
    var audioEnabled = true;	// True if the audio track of publisher is active
    var videoEnabled = true;
    var numOfVideos = 0;
    var layer;
    var socket;
    var isFlag = false; // 是否是会议发起人
    var OPENVIDU_SERVER_URL = "{$video}"; // 视频连接地址
    var OPENVIDU_SERVER_SECRET = "{$videoSecret}"; // 视频连接秘钥
    var timer = null;

    layui.use(['layer', 'form', 'element'], function () {
        layer = layui.layer
        // 初始化通讯录
        $(document).ready(function () {
            var index = layer.load();//loading层
            $.post("/plugin/chat/index.php/video/getAddressList", function(res) {
                if(res.status==1) {
                    zNodes = res.data;
                    var setting = {
                        check: {
                            enable: true,
                            chkboxType: {"Y": "s", "N": "s"}
                        },
                        data: {
                            simpleData: {
                                enable: true,
                                pIdKey: "parentid",
                                rootPId: 0
                            },
                            key: {
                                name: 'realname',
                                children: 'user'
                            }
                        },
                        view: {
                            showIcon: false
                        }

                    };

                    $.fn.zTree.init($("#treeDemo"), setting, zNodes);
                }
                layer.close(index); // 关闭加载层
            }, "json");

            // 监听视频会议
            timer = setInterval(function() {
                $.post('/plugin/chat/index.php/video/joinMeeting', {}, function(res){
                    if(res.status==1) {
                        console.log(res);
                        sessionId = res.data.sessionId;
                        layer.msg('有会议邀请, 正在加载中...');
                        joinRoom();
                    }
                }, "json");
            }, 5000);
        });
    });

  /*  //建立WebSocket通讯
    socket = new WebSocket("{$websocket}");

    //连接成功时触发
    socket.onopen = function(){
        // 登录
        var uid = "{$uinfo['id']}";
        var username = "{$uinfo['username']}";
        var avatar = "{$uinfo['avatar']}";
        var sign = "{$uinfo['sign']}";
        var login_data = '{"type":"videoInit","id":"'+ uid +'","username":"'+ username +'","avatar":"'+ avatar +'","sign":"'+ sign +'"}';
        socket.send( login_data );
        console.log("websocket握手成功!");
    };


    //监听收到的消息
    socket.onmessage = function(res){
        var data = eval("("+res.data+")");
        switch(data['message_type']){
            // 服务端ping客户端
            case 'ping':
                break;
            // 登录 更新用户列表
            case 'init':
                break;
            case 'joinMeetingRoom':
                // 通知用户加入会议室
                // 得到会议室id
                // 发起人的信息
                sessionId = "";
                // 弹窗询问是否加入谁发起的会议
                joinRoom();
                break;
        }
    };*/
</script>
<script src="__PUBLIC__/static/js/video.js"></script>
</body>
</html>